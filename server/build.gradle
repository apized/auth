import org.apache.tools.ant.taskdefs.condition.Os

buildscript {
  dependencies {
    classpath("com.github.docker-java:docker-java-transport-httpclient5:3.2.13") {
      because("M1 macs need a later version of JNA")
    }
  }
}

plugins {
  id 'org.apized.micronaut' version "$apizedVersion"
  id 'jacoco'
}

dependencies {
  annotationProcessor 'io.micronaut.openapi:micronaut-openapi'
  implementation 'com.auth0:java-jwt:4.3.0'
}

application {
  mainClass.set("org.apized.auth.Application")
}

dockerBuildNative {
  images.set([ System.getenv("IMAGE_TAG") ?: "$parent.name:$version" ])
}

dockerfileNative {
  baseImage('alpine:3.17')
  runCommand("apk add gcompat")
}

test {
  if (project.hasProperty('excludeTests')) {
    project.properties['excludeTests']?.replaceAll('\\s', '')?.split('[,;]')?.each {
      exclude "${it}"
    }
  }
}